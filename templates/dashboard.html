<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AION Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; color: #fff; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; color: #00ff88; margin-bottom: 10px; }
        .header p { color: #888; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: #2a2a2a; border-radius: 10px; padding: 20px; border: 1px solid #333; }
        .card h3 { color: #00ff88; margin-bottom: 15px; }
        .stat { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .stat-value { color: #00ff88; font-weight: bold; }
        .button { background: #00ff88; color: #000; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; font-weight: bold; }
        .button:hover { background: #00dd77; }
        .button.secondary { background: #333; color: #fff; }
        .button.secondary:hover { background: #555; }
        .actions { text-align: center; margin: 20px 0; }
        .log { background: #111; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto; font-family: monospace; }
        .log-entry { margin-bottom: 10px; }
        .log-time { color: #666; }
        #output { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° AION Dashboard</h1>
            <p>AI Self-Improvement System Control Panel</p>
        </div>
        
        <div class="grid">
            <div class="card">
                <h3>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h3>
                <div class="stat">
                    <span>–°—Ç–∞—Ç—É—Å:</span>
                    <span class="stat-value" id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                <div class="stat">
                    <span>–ê–Ω–∞–ª–∏–∑–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:</span>
                    <span class="stat-value" id="total-runs">0</span>
                </div>
                <div class="stat">
                    <span>GitHub –ø—Ä–æ–µ–∫—Ç–æ–≤:</span>
                    <span class="stat-value" id="github-projects">0</span>
                </div>
                <div class="stat">
                    <span>Python —Ñ–∞–π–ª–æ–≤:</span>
                    <span class="stat-value" id="python-files">0</span>
                </div>
                <div class="stat">
                    <span>–ü—Ä–æ–±–ª–µ–º –Ω–∞–π–¥–µ–Ω–æ:</span>
                    <span class="stat-value" id="issues-count">0</span>
                </div>
            </div>
            
            <div class="card">
                <h3>üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                <button class="button" onclick="runAnalysis()">üìà –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑</button>
                <button class="button" onclick="runAI()">ü§ñ AI –∞–Ω–∞–ª–∏–∑</button>
                <button class="button" onclick="fixIssues()">‚ö° –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã</button>
                <button class="button secondary" onclick="showProjects()">üåü –ü—Ä–æ–µ–∫—Ç—ã</button>
                <button class="button secondary" onclick="showIssues()">‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã</button>
                <button class="button secondary" onclick="openTerminal()">üíª –¢–µ—Ä–º–∏–Ω–∞–ª</button>
            </div>
            
            <div class="card">
                <h3>üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                <div class="log" id="logs">
                    –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...
                </div>
            </div>
        </div>
        
        <div id="output"></div>
    </div>

    <script>
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        async function updateStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                document.getElementById('status').textContent = data.status === 'ready' ? '–ì–æ—Ç–æ–≤' : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                document.getElementById('total-runs').textContent = data.total_runs || 0;
                document.getElementById('github-projects').textContent = data.github_projects || 0;
                document.getElementById('python-files').textContent = data.python_files || 0;
                document.getElementById('issues-count').textContent = data.issues_count || 0;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤
        async function updateLogs() {
            try {
                const response = await fetch('/api/logs');
                const logs = await response.json();
                
                const logsElement = document.getElementById('logs');
                logsElement.innerHTML = logs.map(log => 
                    `<div class="log-entry">
                        <span class="log-time">[${new Date(log.timestamp).toLocaleString()}]</span>
                        ${log.message}
                    </div>`
                ).join('');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤:', error);
            }
        }
        
        // –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞
        async function runAnalysis() {
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                const data = await response.json();
                
                showOutput(`–ê–Ω–∞–ª–∏–∑ –∑–∞–ø—É—â–µ–Ω (${data.task_id}). –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥...`);
                setTimeout(() => { updateStatus(); updateLogs(); }, 5000);
            } catch (error) {
                showOutput('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∞–ª–∏–∑–∞: ' + error.message);
            }
        }
        
        // AI –∞–Ω–∞–ª–∏–∑
        async function runAI() {
            try {
                const response = await fetch('/api/ai', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'analyze', provider: 'local' })
                });
                const data = await response.json();
                
                showOutput(`AI –∞–Ω–∞–ª–∏–∑ –∑–∞–ø—É—â–µ–Ω (${data.task_id}). –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥...`);
                setTimeout(() => { updateStatus(); updateLogs(); }, 8000);
            } catch (error) {
                showOutput('–û—à–∏–±–∫–∞ AI –∞–Ω–∞–ª–∏–∑–∞: ' + error.message);
            }
        }
        
        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
        async function fixIssues() {
            try {
                const response = await fetch('/api/fix', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ limit: 5 })
                });
                const data = await response.json();
                
                showOutput(`–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø—É—â–µ–Ω—ã (${data.task_id}). –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥...`);
                setTimeout(() => { updateStatus(); updateLogs(); }, 10000);
            } catch (error) {
                showOutput('–û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π: ' + error.message);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã
        async function showProjects() {
            try {
                const response = await fetch('/api/projects');
                const projects = await response.json();
                
                const output = projects.map(p => 
                    `üåü ${p.name}: ${p.stars} ‚≠ê - ${p.description}`
                ).join('\n') || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–µ–∫—Ç–∞—Ö';
                
                showOutput(output);
            } catch (error) {
                showOutput('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤: ' + error.message);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
        async function showIssues() {
            try {
                const response = await fetch('/api/issues');
                const issues = await response.json();
                
                const output = issues.slice(0, 10).map(issue => 
                    `‚ö†Ô∏è ${issue.file}:${issue.line} - ${issue.description || issue.type}`
                ).join('\n') || '–ù–µ—Ç –ø—Ä–æ–±–ª–µ–º –Ω–∞–π–¥–µ–Ω–æ';
                
                showOutput(output);
            } catch (error) {
                showOutput('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–±–ª–µ–º: ' + error.message);
            }
        }
        
        // –û—Ç–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª
        function openTerminal() {
            window.open('/terminal', '_blank');
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–≤–æ–¥
        function showOutput(text) {
            const output = document.getElementById('output');
            output.innerHTML = `<div class="card"><h3>üì§ –†–µ–∑—É–ª—å—Ç–∞—Ç</h3><div class="log">${text.replace(/\n/g, '<br>')}</div></div>`;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateStatus();
        updateLogs();
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            updateStatus();
            updateLogs();
        }, 30000);
    </script>
</body>
</html>